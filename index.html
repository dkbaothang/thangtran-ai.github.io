<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üé§ TH·∫ÆNG TR·∫¶N KARAOKE AI</title>
  <style>
    body { background: #000; color: #fff; font-family: 'Segoe UI', Arial; text-align: center; padding: 20px; margin: 0; }
    .control-panel { background: #111; padding: 20px; border-bottom: 3px solid #f00; position: sticky; top: 0; z-index: 100; }
    .search-container { display: flex; max-width: 800px; margin: 0 auto; gap: 10px; }
    input { flex: 1; padding: 15px; border-radius: 30px; border: 2px solid #333; background: #1a1a1a; color: #fff; font-size: 16px; outline: none; }
    button { padding: 10px 25px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; background: #f00; color: #fff; }
    #player-box { margin: 20px auto; max-width: 950px; aspect-ratio: 16/9; background: #000; border-radius: 20px; overflow: hidden; box-shadow: 0 0 50px rgba(255,0,0,0.3); }
    #status { color: #f44; font-size: 14px; margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>

<div class="control-panel">
  <h1>üé§ TH·∫ÆNG TR·∫¶N KARAOKE AI</h1>

  <div class="search-container">
    <input type="text" id="inputField" placeholder="S·∫øp mu·ªën h√°t b√†i g√¨ ·∫°?...">
    <button id="micBtn" style="background:#333">üé§</button>
    <button onclick="executeSearch()">H√ÅT</button>
  </div>

  <div id="status">S·∫µn s√†ng ph·ª•c v·ª• S·∫øp Th·∫Øng Tr·∫ßn!</div>
</div>

<div id="player-box">
  <div id="player"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
  var player;

  // ‚úÖ Worker Proxy URL (API Key n·∫±m b√≠ m·∫≠t trong Cloudflare)
  const WORKER_URL = "https://thang-tran-karaoke-ai.thangtran.workers.dev/search?q=";

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '100%',
      width: '100%',
      videoId: 'vs_Ji3xfkzI',
      playerVars: {
        autoplay: 1,
        origin: window.location.origin,
        enablejsapi: 1
      }
    });
  }

  async function executeSearch() {
    const input = document.getElementById('inputField').value.trim();
    if (!input) return;

    document.getElementById('status').innerText = "üîç AI ƒëang t√¨m b√†i h√°t karaoke cho S·∫øp...";

    const url = WORKER_URL + encodeURIComponent(input + " karaoke");

    try {
      const response = await fetch(url);
      const data = await response.json();

      if (data.items && data.items.length > 0) {
        const videoId = data.items[0].id.videoId;
        const title = data.items[0].snippet.title;

        player.loadVideoById(videoId);
        document.getElementById('status').innerText = "‚úÖ ƒê√£ t√¨m th·∫•y: " + title;
      } else {
        document.getElementById('status').innerText = "‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y b√†i h√°t.";
      }

    } catch (e) {
      document.getElementById('status').innerText = "‚ùå L·ªói k·∫øt n·ªëi Worker.";
    }
  }

  // üéôÔ∏è Voice Search
  const micBtn = document.getElementById('micBtn');
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'vi-VN';

  micBtn.onclick = () => {
    recognition.start();
    document.getElementById('status').innerText = "üéôÔ∏è AI ƒëang nghe S·∫øp...";
  };

  recognition.onresult = (event) => {
    document.getElementById('inputField').value = event.results[0][0].transcript;
    executeSearch();
  };
</script>

</body>
</html>
